{% extends "layout.html" %}

{% block body %}

<h3>
    Auction details
</h3>

<table>
    <tr>
        <td>
            Title
        </td>
        <td>
            {{ auction.title }}
        </td>
    </tr>
    <tr>
        <td>
            Description
        </td>
        <td>
            {{ auction.description }}
        </td>
    </tr>
    <tr>
        <td>
            Created
        </td>
        <td>
            {{ auction.date_created }}
        </td>
    </tr>
    <tr>
        <td>
            Ends
        </td>
        <td>
            {{ auction.date_ends }} - <i>
                {% if ended == 1 %}
                    ended
                {% else %}
                    {{ days_to_go }} days remaining
                {% endif %}
            </i>
        </td>
    </tr>
    <tr>
        <td>
            Seller
        </td>
        <td>
            {{ seller }}
        </td>
    </tr>
    <tr>
        <td>
            Minimum bid
        </td>
        <td>
            {{ auction.minimum_bid }}
        </td>
    </tr>
    <tr>

    </tr>
    <tr>
        <td>
            Winning bid
        </td>
        <td>
            {% if highest_bid.amount == 0 %}
            no bids
            {% else %}
            <b>{{ highest_bid.amount }}</b> by <i>{{ highest_bid.bidder }}</i>
            {% endif %}
        </td>
    </tr>
</table>

<p/>
<br/>

<h3>
    Bidding
</h3>

<form method="POST" 
      action="{{ url_for('auctions_view', auction_id = auction.id) }}">
    <table>
        <tr>
            <td>
                {{ form.amount.label }}
            </td>
            <td>
                {{ form.amount }}
            </td>
            <td>
                <ul>
                    {% for error in form.amount.errors %}
                    <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            </td>
        </tr>
        <tr>
            <td colspan="2">
                <input type="submit" value="Place bid"/>
            </td>
            <td>
                <span style='color: red'>{{ biderror }}</span>
            </td>
        </tr>
    </table>
</form>

<p/>

<table>
    <tr>
        <th>Amount</th>
        <th>Bidder</th>
        <th>Date</th>
    </tr>
    {% for bid in bids %}
    <tr>
        <td>{{ bid.amount }}</td>
        <td>{{ bid.bidder }}</td>
        <td>{{ bid.date }}</td>
    </tr>
    {% endfor %}
</table>

<p/>
<br/>

<h3>
    Messages
</h3>
<form method="POST"
      action="{{ url_for('messages_create', auction_id = auction.id) }}">
    <table>
        <tr>
            <td>
                {{ form.message.label }}
            </td>
            <td>
                {{ form.message }}
            </td>
            <td>
                <ul>
                    {% for error in form.message.errors %}
                    <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            </td>
        </tr>
        <tr>
            <td colspan="2">
                <input type="submit" value="Post message"/>
            </td>
        </tr>
    </table>
</form>

<p/>

<table>
    <tr>
        <th>Delete</th>
        <th>Edit</th>
        <th>By</th>
        <th>Message</th>
        <th>Created</th>
        <th>Edited</th>
    </tr>
    {% for message in messages %}
    <tr>
        <td>
            {% if current_user.id == message.author_id %}
            <form method="POST" action="{{ url_for('messages_delete', message_id = message.id) }}">
                <input type="submit" value="Delete"/>
            </form>
            {% endif %}
        </td>
        <td></td>
        <td>{{ message.author }}</td>
        {% if auction.account_id == message.author_id %}
        <td><b>{{ message.body }}</b></td>
        {% else %}
        <td>{{ message.body }}</td>
        {% endif %}
        <td>{{ message.date_created }}</td>
        <td>{{ message.date_modified }}</td>
    </tr>
    {% endfor %}
</table>

{% endblock %}
